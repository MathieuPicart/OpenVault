<!-- Page Dashboard OpenVault -->
<div class="min-h-screen bg-gray-50 font-display pb-24">

    <!-- Header -->
    <header class="px-6 pt-8 pb-6 flex justify-between items-start">
        <div>
            <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Bienvenue</p>
            <h1 class="text-2xl font-bold text-gray-900">Bonjour, {{ user?.firstName + ' ' + user?.lastName || '...' }}</h1>
        </div>
        <button (click)="logout()"
            class="w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-600 hover:bg-gray-50 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                </path>
            </svg>
        </button>
    </header>

    <!-- État de chargement -->
    @if (isLoading) {
    <div class="px-6 space-y-6">
        <div class="bg-[#3c83f6] rounded-[28px] p-6 h-32 animate-pulse opacity-70"></div>
        <div class="grid grid-cols-2 gap-4">
            <div class="h-14 bg-gray-200 rounded-full animate-pulse"></div>
            <div class="h-14 bg-gray-200 rounded-full animate-pulse"></div>
        </div>
        <div class="space-y-4">
            <div class="h-24 bg-white rounded-[24px] animate-pulse"></div>
            <div class="h-24 bg-white rounded-[24px] animate-pulse"></div>
        </div>
    </div>
    }

    <!-- Erreur -->
    @if (error && !isLoading) {
    <div class="mx-6 p-4 bg-red-50 border border-red-100 rounded-2xl text-red-600 text-sm flex items-center space-x-2">
        <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>{{ error }}</span>
    </div>
    }

    @if (!isLoading) {
    <main class="px-6 space-y-6">

        <!-- Carte Solde Total -->
        <div class="bg-[#3c83f6] rounded-[28px] p-6 shadow-xl shadow-blue-500/20 text-white relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl"></div>
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white/80 text-sm font-medium">Solde total</span>
                    <svg class="w-5 h-5 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                        </path>
                    </svg>
                </div>
                <div class="text-4xl font-bold tracking-tight mb-3">
                    {{ totalBalance | currency:'EUR':'symbol':'1.2-2':'fr' }}
                </div>
                <div class="flex items-center space-x-2 text-white/90 text-sm">
                    <span class="bg-white/20 px-2 py-0.5 rounded-md text-xs font-semibold">
                        {{ accounts.length }} compte{{ accounts.length > 1 ? 's' : '' }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Boutons d'action rapide -->
        <div class="grid grid-cols-2 gap-4">
            <button (click)="navigateTo('/transfer')"
                class="flex items-center justify-center space-x-2 py-4 bg-blue-50 text-[#3c83f6] rounded-full font-semibold transition-all active:scale-95 hover:bg-blue-100">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                </svg>
                <span>Virement</span>
            </button>
            <button (click)="navigateTo('/accounts')"
                class="flex items-center justify-center space-x-2 py-4 bg-blue-50 text-[#3c83f6] rounded-full font-semibold transition-all active:scale-95 hover:bg-blue-100">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                    </path>
                </svg>
                <span>Comptes</span>
            </button>
        </div>

        <!-- Section Mes comptes -->
        <section>
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-gray-900">Mes comptes</h2>
                <button (click)="navigateTo('/accounts')"
                    class="text-[#3c83f6] text-sm font-semibold hover:underline">Voir tout</button>
            </div>

            @if (accounts.length === 0) {
            <div class="p-6 bg-white rounded-[24px] shadow-sm border border-gray-100 text-center text-gray-400 text-sm">
                Aucun compte. <button (click)="navigateTo('/accounts')" class="text-[#3c83f6] font-semibold">Créer un
                    compte</button>
            </div>
            }

            <div class="space-y-4">
                @for (account of accounts; track account.id) {
                <div
                    class="p-5 bg-white rounded-[24px] shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-gray-900">{{ getAccountTypeLabel(account.type) }}</h3>
                            <p class="text-xs text-gray-400 font-mono tracking-tight">{{ maskIban(account.iban) }}</p>
                        </div>
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                            [class]="account.type === 'SAVINGS' ? 'bg-amber-50' : 'bg-blue-50'">
                            @if (account.type === 'SAVINGS') {
                            <svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            } @else {
                            <svg class="w-4 h-4 text-[#3c83f6]" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                            </svg>
                            }
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-gray-900">
                        {{ account.balance | currency:'EUR':'symbol':'1.2-2':'fr' }}
                    </div>
                </div>
                }
            </div>
        </section>

        <!-- Section Activité récente -->
        <section>
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-gray-900">Activité récente</h2>
                <button (click)="navigateTo('/transactions')"
                    class="text-[#3c83f6] text-sm font-semibold hover:underline">Voir tout</button>
            </div>

            @if (recentTransactions.length === 0) {
            <div class="p-6 bg-white rounded-[24px] shadow-sm border border-gray-100 text-center text-gray-400 text-sm">
                Aucune transaction pour le moment.
            </div>
            } @else {
            <div class="bg-white rounded-[24px] shadow-sm overflow-hidden border border-gray-100">
                <div class="divide-y divide-gray-50">
                    @for (tx of recentTransactions; track tx.id) {
                    <div class="flex items-center justify-between p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center"
                                [class]="isCredit(tx) ? 'bg-green-100' : 'bg-red-100'">
                                @if (isCredit(tx)) {
                                <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                </svg>
                                } @else {
                                <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                                </svg>
                                }
                            </div>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">{{ tx.description || tx.type }}</p>
                                <p class="text-xs text-gray-400">{{ formatDate(tx.timestamp) }}, {{
                                    formatTime(tx.timestamp) }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-sm" [class]="getTransactionColor(tx)">
                                {{ getTransactionSign(tx) }} {{ tx.amount | currency:'EUR':'symbol':'1.2-2':'fr' }}
                            </p>
                        </div>
                    </div>
                    }
                </div>
            </div>
            }
        </section>
    </main>
    }

    <!-- Bottom Navigation Bar -->
    <nav
        class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-gray-100 px-8 pb-6 pt-3 flex items-center justify-between z-50">
        <button class="flex flex-col items-center justify-center space-y-1 text-[#3c83f6]">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
            </svg>
            <span class="text-[10px] font-bold">Accueil</span>
        </button>
        <button (click)="navigateTo('/transfer')"
            class="flex flex-col items-center justify-center space-y-1 text-gray-400 hover:text-[#3c83f6] transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
            </svg>
            <span class="text-[10px] font-bold">Virement</span>
        </button>
        <button (click)="navigateTo('/transactions')"
            class="flex flex-col items-center justify-center space-y-1 text-gray-400 hover:text-[#3c83f6] transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                </path>
            </svg>
            <span class="text-[10px] font-bold">Activité</span>
        </button>
        <button (click)="navigateTo('/accounts')"
            class="flex flex-col items-center justify-center space-y-1 text-gray-400 hover:text-[#3c83f6] transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
            </svg>
            <span class="text-[10px] font-bold">Comptes</span>
        </button>
    </nav>
</div>